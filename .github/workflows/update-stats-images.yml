name: Update Stats Images

on:
  schedule:
    - cron: '0 2 * * *'   # runs daily at 02:00 UTC (adjust if you want)
  workflow_dispatch:

jobs:
  update-stats:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create assets dir
        run: mkdir -p assets

      - name: Download GitHub Readme Stats image (fallback & lowercase username)
        run: |
          curl -sSL "https://github-readme-stats.vercel.app/api?username=dark-vinaal&show_icons=true&hide=contribs,prs&cache_seconds=86400&theme=ayu-mirage" -o assets/github_stats.png || echo "fetch stats failed"

      - name: Download Streak (mirror)
        run: |
          curl -sSL "https://streak-stats.demolab.com?user=dark-vinaal&theme=ayu-mirage&hide_border=false" -o assets/streak_stats.png || echo "fetch streak failed"

      - name: Download Profile Card (optional)
        run: |
          curl -sSL "https://github-profile-summary-cards.vercel.app/api/cards/profile-details?username=dark-vinaal&theme=2077" -o assets/profile_card.png || echo "fetch profile card failed"

      - name: Commit images
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add assets/*.png
          git commit -m "chore: update stat images" || echo "no changes to commit"
          git push
